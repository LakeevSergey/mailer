# Email нотификатор

## Общие требования

Задача разработать HTTP API email нотификации пользователей о различных событиях. Ожидаемая нагрузка ~30 писем в минуту.
Опционально — API для управления шаблонами, то есть получение, добавление, редактирование и добавление шаблонов.

## Шаблоны писем

Для формирования письма сервис должен использовать заранее подготовленную базу шаблонов. Клиенты передают идентификатор шаблона, email получателя и пользовательские данные, которые нужно подставить в шаблон. Формат шаблонов — twig (опционально — реализовать другие форматы шаблонов)

## Отправка писем

Для передачи писем используется внешний SMTP сервер (опционально — реализовать другие протоколы, например IMAP). Отправка должна происходить асинхронно, клиенты не должны дожидаться успешной отправки письма.

## Требования к отказоустойчивости

Письма, которые не получилось отправить из-за проблем с соединением с внешним сервисом или из-за превышений лимитов сервиса, должны быть отложены и отправлены в ближайшее возможное время. Письма, которые невозможно отправить (например, неправильно сформированн запрос на отправку), должны быть сохранены для дальнейшего анализа и исправления ошибок. Любые внештатные ситуации должны быть записаны (например, запрос на отправку несуществующего шаблона, неожиданный ответ от SMTP сервера и т.д.)

## HTTP API

Должна быть реализована поддержка сжатия данных. Должна быть реализована проверка подписи полученных запросов.

### Методы
```
POST /api/send
```
Формат запроса
```
POST /api/send HTTP/1.1
Content-Type: application/json
Signature: 2e470d1f73a90c3a24b6d649a1cfd1488705adead086f0241dee002f86bdd22a
Timestamp: 1673210928
...

{
    "template": "test_template",
    "params": {
      "name": "Sergei"
    },
    "send_to": [
        "prot1vogas@yandex.ru"
    ]
}
```
Заголовок Signature получается из следующих данных:
1. Ключ из переменной среды HASHER_KEY
2. Данные запроса в формате:
```
Method:Path:Body
Timestamp:current timestamp
```
Пример:
```
POST:/api/send:{
    "template": "test_template",
    "params": {
      "name": "Sergei"
    },
    "send_to": [
        "prot1vogas@yandex.ru"
    ]
}
Timestamp:1673210928
```
